// JSON de servicios y subtipologías
const servicios = {
  "MEDICINA_GENERAL": [
    "PROGRAMACION VALORACION MEDICO GENERAL",
    "PROGRAMACION INGRESO A PAD",
    "DIA DE VISITA MEDICO GENERAL",
    "VISITAS FALLIDAS MEDICOS",
    "INASISTENCIA MEDICO",
    "CERRAR/SUBIR HISTORIA CLINICA MEDICO GENERAL",
    "ENTREGA DE RECETARIO OFICIAL",
    "EGRESO PADO",
    "INCONFORMIDAD EGRESO SIN ACTO MEDICO",
    "ERROR FORMULACION MEDICO",
    "ERROR DE MIPRES MEDICO",
    "ERROR DILIGENCIAMIENTO DE INCAPACIDAD",
    "MIPRES NO REGISTRADO EN PLATAFORMA",
    "FORMULACION DE INCAPACIDAD",
    "FORMULACION DE CUIDADOR",
    "OLVIDO FAMILIARES FORMULACIÓN U ORDEN",
    "OLVIDO MEDICO",
    "LECTURA DE PARACLINICOS",
    "ORDEN VIGENTE MEDICAMENTO E INSUMOS",
    "ORDENAMIENTO DE TRASLADO",
    "INCONFORMIDAD EN EL ACTO MEDICO"
  ],
  "ESPECIALISTAS": [
    "PROGRAMACION VALORACION FISIATRIA",
    "PROGRAMACION VALORACION NEUROLOGIA",
    "PROGRAMACION VALORACION MEDICINA INTERNA",
    "PROGRAMACION VALORACION MEDICINA FAMILIAR",
    "DÍA DE VISITA MEDICIA INTERNA",
    "INASISTENCIA MEDICINA INTERNA",
    "VISITAS FALLIDAS MEDICINA INTERNA",
    "CIERRE MODIFICACION O SUBIR HC MEDICINA INTERNA",
    "INASISTENCIA NEUROLOGIA",
    "VISITAS FALLIDAS NEUROLOGIA",
    "CIERRE MODIFICACION O SUBIR HC NEUROLOGIA",
    "VISITAS FALLIDAS FISIATRIA",
    "INASISTENCIA FISIATRIA",
    "CIERRE MODIFICACION O SUBIR HC FISIATRIA",
    "ORDENAMIENTO DE EXCLUSIONES DEL SISTEMA",
    "COMITES PARA EXCLUSIONES DEL SISTEMA",
    "INCONFORMIDAD EN EL ACTO CON ESPECIALISTA",
    "LECTURA DE PARACLINICOS"
  ],
  "ENFERMERIA_Y_CUIDADOR": [
    "INCUMPLIMIENTO DE SERVICIO CUIDADOR ENFERMERIA",
    "ASIGNACION DEL SERVICIO DE CUIDADOR",
    "ENTRENAMIENTO POR ENFERMERIA",
    "INTERVENCION DE EDUCACION CUIDADOR ENFERMERIA",
    "EVENTO ADVERSO CUIDADOR ENFERMERIA",
    "CAMBIO DE PERSONA CUIDADOR ENFERMERIA",
    "PERSONAL FIJO",
    "COMITES DE CUIDADOR ENFERMERIA",
    "DERECHOS Y DEBERES DE SERVICIO CUIDADOR ENFERMERIA",
    "PACIENTE DESCUBIERTO"
  ],
  "TERAPIAS": [
    "INICIO DE TERAPIAS",
    "INCUMPLIMIENTO DE TERAPIAS",
    "VALORACION POR AUDITORIA",
    "PROGRAMACION VALORACION POR AUDITORIA",
    "INCOFORMIDAD EN EL ACTO TERAPEUTICO",
    "CAMBIO DE PROFESIONAL TERAPEUTICO",
    "EVENTO ADVERSO TERAPIAS",
    "COMITES DE TERAPIAS"
  ],
  "CLINICA_DE_HERIDAS": [
    "PROGRAMACION VALORACION CLINICA DE HERIDAS",
    "INASISTENCIA CLINICA DE HERIDAS",
    "CAMBIO DE PERSONA CLINICA DE HERIDAS",
    "EVENTO ADBERSO CLINICA DE HERIDAS",
    "INTERVENCION DE EDUCACION CLINICA DE HERIDAS",
    "FORMULACION DE INSUMOS DE CLINICA DE HERIDAS"
  ],
  "PROCEDIMIENTOS": [
    "CAMBIO DE SONDA",
    "EVENTO ADVERSO CAMBIO DE SONDA",
    "URGENCIAS CAMBIOS DE SONDAS",
    "INTERVENCION DE EDUCACION PROCEDEMIENTOS",
    "TOMA DE LABORATORIOS CRONICOS"
  ],
  "NUTRICION": [
    "PROGRAMACION VALORACION NUTRICION",
    "DÍA DE VISITA NUTRICIÓN",
    "CIERRE MODIFICACION O SUBIR HC NUTRICION",
    "VISITAS FALLIDAS NUTRICION",
    "INASISTENCIA NUTRICION",
    "ERROR DE MIPRES NUTRICION",
    "ERROR DE FORMULACION NUTRICION",
    "MIPRES NO REGISTRADO EN PLATAFORMA",
    "INTOLERANCIA AL APME",
    "ORDEN VIGENTE NUTRICION",
    "INCONFORMIDAD EN EL ACTO CON NUTRICIONISTA",
    "FORMULACION DE NUTRICION"
  ],
  "NUTRIDOM": [
    "PROGRAMACION VALORACION POR NUTRICION",
    "VISITA FALLIDA NUTRIDOM",
    "INASISTENCIA NUTRIDOM",
    "DIRECCIONAMIENTO MIPRES APME",
    "ENTREGA APME",
    "APME PENDIENTES",
    "PROGRAMACION COMITÉ NUTRIDOM",
    "FORMULACION DE APME",
    "ERROR DE FORMULACION APME",
    "EGRESO DE NUTRIDOM",
    "ERROR DE MIPRES APME",
    "INTOLERANCIA AL APME",
    "INCONFORMIDAD DECISIÓN DEL COMITÉ DE NUTRIDOM"
  ],
  "TRABAJO_SOCIAL": [
    "PROGRAMACION VALORACION TRABAJO SOCIAL",
    "DÍA DE VISITA TRABAJO SOCIAL",
    "CIERRE MODIFICACION O SUBIR HC TRABAJO SOCIAL",
    "VISITAS FALLIDAS TRABAJO SOCIAL",
    "INASISTENCIA TRABAJO SOCIAL",
    "VALORACION POR TRABAJO SOCIAL",
    "INCONFORMIDAD EN EL ACTO TRABAJO SOCIAL"
  ],
  "PSICOLOGIA": [
    "PROGRAMACION VALORACION PSICOLOGIA",
    "DÍA DE VISITA PSICOLOGIA",
    "CIERRE MODIFICACION O SUBIR HC DE PSICOLOGIA",
    "VISITAS FALLIDAS PSICOLOGIA",
    "INCONFORMIDAD EN EL ACTO CON PSICOLOGO",
    "INASISTENCIA PSICOLOGIA"
  ],
  "PHD_AGUDOS": [
    "PROGRAMACION VALORACION PHD",
    "ENVIO DE ORDENES MEDICAS PHD",
    "ENVIO DE HISTORIAS CLINICAS PHD",
    "OLVIDO MEDICO PHD",
    "APLICACIÓN DE MEDICAMENTOS",
    "INCUMPLIMIENTO EN LA APLICACIÓN DEL MEDICAMENTO",
    "INCUMPLIMIENTO CURACIONES PHD",
    "TOMA DE LABORATORIOS PHD"
  ],
  "PROGRAMAS_ESPECIALES": [
    "PROGRAMACION GASTROPEDIATRIA",
    "PRIORITARIAS PADO",
    "PROGRAMACION SEGUIMIENTO PRIORITARIAS PADO",
    "PROGRAMACION ODONTOLOGIA"
  ],
  "INSUMOS": [
    "PROGRAMACION ENTREGA DE INSUMOS",
    "INSUMOS PENDIENTES",
    "DIA DE ENTREGA DE INSUMOS",
    "ENTREGA DE INSUMOS FALLIDA",
    "CALIDAD DE INSUMOS",
    "INCONFORMIDAD POR TALLAS O MARCAS"
  ],
  "EQUIPOS_BIOMEDICOS": [
    "ENTREGA DE EQUIPOS BIOMEDICOS",
    "MANTENIMIENTO EQUIPOS BIOMEDICOS",
    "INCUMPLIMIENTO MANTENIMIENTO EQUIPOS BIOMEDICOS",
    "COMPORTAMIENTO DEL BIOMEDICO",
    "ENTREGA DE CAMAS HOSPITALARIAS",
    "RECOGIDA O CAMBIOS CAMAS HOSPITALARIAS",
    "MANTENIMIENTO CAMAS HOSPITALARIAS"
  ],
  "AUTORIZACIONES": [
    "AUMENTO DE SERVICIO DE CUIDADOR",
    "MIPRES EN JUNTA MEDICA",
    "ESTADO DE RADICADO",
    "VERIFICACION DE AUTORIZACION",
    "RADICACION DE CUIDADOR"
  ],
  "RECOLECCION_DE_RESIDUOS": [
    "INCUMPLIMIENTO RECOLECCION DE RESIDUOS",
    "RECOLECCION FALLIDA"
  ],
  "NOVEDADES": [
    "INGRESO A HOSPITALIZACION",
    "EGRESO HOSPITALARIO",
    "FALLECIMIENTO",
    "SERVICIO AMBULANCIA"
  ],
  "SOPORTES": [
    "ENVIO DE HISTORIAS CLINICAS CRONICOS",
    "ENVIO DE HISTORIA CLINICA PROGRAMA ESPECIALES",
    "ENVIO DE ORDENES MEDICAS CRONICOS",
    "ENVIO DE SOPORTES DE EVOLUCIONES TERAPIAS",
    "ENVIO EVOLUCION DE AUDITORIA DE TERAPIAS",
    "ENVIO EVOLUCION DE CLINICA DE HERIDAS",
    "ENVIO DE INCAPACIDAD MEDICA",
    "ENVIO DE SOPORTES DE NOTAS EYC",
    "ENVIO DE CERTIFICADO DE DEPENDENCIA",
    "CERTIFICADO SERVICIO HOMECARE",
    "ENVIO DE MIPRES",
    "ENVIO DE JUNTA DE MIPRES",
    "ENVIO DE SOPORTE EVOLUCION APLICACIÓN DE MEDICAMENTOS",
    "ENVIO DE RESULTADOS DE LABORATORIOS"
  ],
  "INFORMACION": [
    "ACTUALIZACION DE DATOS",
    "CREACION DE PACIENTES",
    "ENCUESTAS DE SATISFACCION",
    "POLITICA DE TRATAMIENTO DE DATOS",
    "HORARIOS DE ATENCION Y UBICACIÓN DE SEDES",
    "NO CORRESPONDE A MTD",
    "LLAMADA CORTADA",
    "FELICITACIONES O AGRADECIMIENTO"
  ],
  "CONTRATISTAS": [
    "FECHAS PAGO",
    "INCONSISTENCIAS EN EL PAGO",
    "DEMORA EN LAS FECHAS DE PAGO",
    "PAGO DE LIQUIDACIONES",
    "PAGO DE SEGURIDAD SOCIAL",
    "DEVOLUCIONES DE PAGOS DE SS",
    "FALLAS EN LA ATENCION DE SEGURIDAD SOCIAL",
    "INCONSISTENCIAS EN LA CUENTA DE COBRO",
    "REGISTROS PENDIENTES",
    "FALLAS DE COMUNICACIÓN ANALISTA",
    "APERTURA DE SISTEMAS PARA SUBIR NOTAS",
    "CERTIFICACIONES LABORALES"
  ]
};

document.addEventListener('DOMContentLoaded', function () {
  const tipoSelect = document.getElementById('tipo_de_servicio');
  const subTipoSelect = document.getElementById('subtipologia');
  const rol = localStorage.getItem('rol'); // Obtiene el rol del usuario

  // Llena el select de tipo de servicio
  Object.keys(servicios).forEach(key => {
    const option = document.createElement('option');
    option.value = key;
    option.textContent = key.replace(/_/g, ' ');
    tipoSelect.appendChild(option);
  });

  // Si el rol es "responsable", subtipología siempre permanece deshabilitada
  if (rol === 'responsable') {
    subTipoSelect.disabled = true;
  }

  // Cuando cambia el tipo, actualiza subtipología (solo si no es responsable)
  tipoSelect.addEventListener('change', function () {
    const subtipos = servicios[this.value] || [];
    subTipoSelect.innerHTML = '';

    if (rol === 'responsable') {
      // Responsable no puede cambiar subtipología
      subTipoSelect.disabled = true;
      subTipoSelect.appendChild(new Option('No disponible para tu rol', ''));
      return;
    }

    if (subtipos.length) {
      subTipoSelect.disabled = false;
      subTipoSelect.appendChild(new Option('Seleccione...', ''));
      subtipos.forEach(sub => {
        const option = document.createElement('option');
        option.value = sub;
        option.textContent = sub;
        subTipoSelect.appendChild(option);
      });
    } else {
      subTipoSelect.disabled = true;
      subTipoSelect.appendChild(new Option('Seleccione un tipo primero...', ''));
    }
  });

  // NOTA: ya no forzamos subTipoSelect.disabled = false al final,
  // para respetar el bloqueo para responsables.
});
